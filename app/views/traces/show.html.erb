<!-- Content Header (Page header) -->
<section class="content-header">
  <h1>
    Trace
  </h1>
  <ol class="breadcrumb">
  </ol>
</section>

<section class="content">
  <div class="row">
    <div class="col-lg-12 connectedSortable">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Transaction Sample <%= @trace.duration.to_f %></h3>
        </div>
        <div class="box-body">
          <div id="visualization"></div>
          <script>
            function setSelection(sample_id) {
              if(sample_id) {
                $("#sample").load("/applications/<%= @current_application.id %>/samples/" + sample_id);
              }
            }
            groups = []
            items = []
            group_index = 0
            item_index = 0

            var groups = new vis.DataSet(<%= @groups.to_json.html_safe %>);
            var items = new vis.DataSet(<%= @items.to_json.html_safe %>);

            var container = document.getElementById('visualization');
            var options = {
              groupOrder: function (a, b) {
                return a.value - b.value;
              },
              order: function(a, b) {
                return a.id - b.id;
              }
            };

            var timeline = new vis.Timeline(container);
            timeline.on('select', function (properties) {
              setSelection(properties.items[0]);
            });
            timeline.setOptions(options);
            timeline.setGroups(groups);
            timeline.setItems(items);

            $(document).ready(function() {
              <% if @sample %>
              timeline.setSelection([<%= @sample.id %>]);
              setSelection(<%= @sample.id %>);
              <% end %>
            });
          </script>
        </div>
      </div>

      <div id="sample"></div>
    </div>
  </div>
  <% if false %>
  <div class="row">
    <div class="col-lg-12 connectedSortable">
      <div class="box">
        <div class="box-header">
          <h3 class="box-title">Transaction Sample <%= @trace.duration.to_f %></h3>
        </div>
        <div class="box-body" style="overflow-y: scroll; height: 300px;">
          <table class="table">
            <%= render @root_with_children, :depth => 0, :version => 1 %>
          </table>
        </div>
      </div>
    </div>
  </div>
  <% end %>
</section>
